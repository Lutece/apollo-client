<!DOCTYPE html>
<html lang="en">
  <head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">

    
      <!-- Google Tag Manager -->
      <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
      j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
      'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
      })(window,document,'script','dataLayer','GTM-PNFDVBB');</script>
      <!-- End Google Tag Manager -->
    

    <!-- Basic -->
    <title>Integrating with Meteor | Apollo Client</title>
    <meta name="description" content="Specifics about using Apollo in your Meteor application.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
      <link rel="shortcut icon" type="image/png" href="../images/favicon-apollo.png" sizes="16x16 32x32 64x64">
    

    <!-- Social -->
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://www.apollographql.com/docs/react">
    <meta property="og:title" content="Integrating with Meteor | Apollo Client">
    <meta property="og:description" content="Specifics about using Apollo in your Meteor application.">
    <meta property="og:image" content="">
    <meta name="twitter:site" content="@apollographql">
    <meta name="twitter:title" content="Integrating with Meteor | Apollo Client">
    <meta name="twitter:description" content="Specifics about using Apollo in your Meteor application.">
    <meta name="twitter:image" content="">

    <!-- Misc -->
    <meta name="google-site-verification" content="">

    
    
    <link href="//cdn.jsdelivr.net/npm/prismjs@1.15.0/themes/prism.min.css" rel="stylesheet" type="text/css">
    <link href="//cdn.jsdelivr.net/npm/prismjs@1.15.0/plugins/line-numbers/prism-line-numbers.min.css" rel="stylesheet" type="text/css">
    <link href="//cdn.jsdelivr.net/npm/prismjs@1.15.0/plugins/line-highlight/prism-line-highlight.css" rel="stylesheet" type="text/css">

    <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300,200,300italic,400italic" rel="stylesheet" type="text/css">
    
      <link rel="stylesheet" href="../style/bundle-apollo.css">
    
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css">
  </head>
  <body class="">
    
      <!-- Google Tag Manager (noscript) -->
      <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PNFDVBB" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
      <!-- End Google Tag Manager (noscript) -->
    
      

  <div class="nav sunset">
    <div class="nav-group left">
      <div class="nav-item mobile-button js-sidebar-toggle show-mobile">
        <span class="icon-menu"></span>
      </div>
      <div class="nav-item">
        
        <a class="logo-wrapper" href="https://www.apollographql.com/" title="Apollo ">
          <img src="../images/logo-apollo-space-left.svg" alt="Apollo" class="logo">
          
            <span></span>
          
        </a>
      </div>
    </div>


    
      <div class="nav-group right">
        <div id="nav-container" class="show-desktop"></div>
        <script src="https://apollographql-nav.netlify.com/index.js"></script>
        <script>ApolloNav.initNav({ theme: 'light' }, 'nav-container')</script>
      </div>
    
    </div>
  

  

<div class="sidebar charcoal">
  <div class="panel">
    
      <div id="sidebar-panel-nav"></div>
      <script>ApolloNav.initNav({ theme: 'light', id: 'mobile-nav' }, 'sidebar-panel-nav')</script>
    
  </div>

  <div class="sidebar-content">
    <div class="topcap">
      <span class="title-sidebar">Apollo Client</span>
      
        <span class="select version-sidebar nochrome">
          <select class="version-select">
            
              <option value="v2.5">2.5</option>
            
              <option value="v2.4">2.4</option>
            
          </select>
        </span>
      
    </div>

    
    <div class="wrapper-search">
      <div class="input-area">
        <div class="input-symbol small round">
          <input type="text" placeholder="Search React Guide" id="desktop-search-input">
          <span class="icon-search"></span>
        </div>
      </div>
      <div class="wrapper-desktop-search-results"></div>
    </div>

    

    <ul class="toc">
      

        <li>
          

          <ul class="list-toc">
            
              
              
              <li class="item-toc ">
                <a href="../." class="sidebar-link ">
                  <span>Introduction</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../why-apollo.html" class="sidebar-link ">
                  <span>Why Apollo Client?</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../integrations.html" class="sidebar-link ">
                  <span>View integrations</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../react-apollo-migration.html" class="sidebar-link ">
                  <span>New in React Apollo 2.1</span>
                </a>
              </li>
              
            
          </ul>
        </li>

        <hr>
      

        <li>
          
            <div class="heading-toc">Essentials</div>
          

          <ul class="list-toc">
            
              
              
              <li class="item-toc ">
                <a href="../essentials/get-started.html" class="sidebar-link ">
                  <span>Get started</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../essentials/queries.html" class="sidebar-link ">
                  <span>Queries</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../essentials/mutations.html" class="sidebar-link ">
                  <span>Mutations</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../essentials/local-state.html" class="sidebar-link ">
                  <span>Local state management</span>
                </a>
              </li>
              
            
          </ul>
        </li>

        <hr>
      

        <li>
          
            <div class="heading-toc">Features</div>
          

          <ul class="list-toc">
            
              
              
              <li class="item-toc ">
                <a href="../features/error-handling.html" class="sidebar-link ">
                  <span>Error handling</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../features/pagination.html" class="sidebar-link ">
                  <span>Pagination</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../features/optimistic-ui.html" class="sidebar-link ">
                  <span>Optimistic UI</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../features/server-side-rendering.html" class="sidebar-link ">
                  <span>Server-side rendering</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../features/developer-tooling.html" class="sidebar-link ">
                  <span>Developer tools</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../features/defer-support.html" class="sidebar-link ">
                  <span>Deferred queries</span>
                </a>
              </li>
              
            
          </ul>
        </li>

        <hr>
      

        <li>
          
            <div class="heading-toc">Advanced</div>
          

          <ul class="list-toc">
            
              
              
              <li class="item-toc ">
                <a href="../advanced/boost-migration.html" class="sidebar-link ">
                  <span>Apollo Boost migration</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../advanced/subscriptions.html" class="sidebar-link ">
                  <span>Subscriptions</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../advanced/network-layer.html" class="sidebar-link ">
                  <span>Network layer (Apollo Link)</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../advanced/caching.html" class="sidebar-link ">
                  <span>Caching data</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../advanced/fragments.html" class="sidebar-link ">
                  <span>Using fragments</span>
                </a>
              </li>
              
            
          </ul>
        </li>

        <hr>
      

        <li>
          
            <div class="heading-toc">Recipes</div>
          

          <ul class="list-toc">
            
              
              
              <li class="item-toc ">
                <a href="authentication.html" class="sidebar-link ">
                  <span>Authentication</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="testing.html" class="sidebar-link ">
                  <span>Testing React components</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="static-typing.html" class="sidebar-link ">
                  <span>Using TypeScript</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="performance.html" class="sidebar-link ">
                  <span>Improving performance</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="react-native.html" class="sidebar-link ">
                  <span>Integrating with React Native</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="babel.html" class="sidebar-link ">
                  <span>Compiling queries with Babel</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="webpack.html" class="sidebar-link ">
                  <span>Loading queries with Webpack</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc current">
                <a href="" class="sidebar-link current">
                  <span>Integrating with Meteor</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="recompose.html" class="sidebar-link ">
                  <span>Recompose patterns</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="2.0-migration.html" class="sidebar-link ">
                  <span>Apollo Client 1.0 migration</span>
                </a>
              </li>
              
            
          </ul>
        </li>

        <hr>
      

        <li>
          
            <div class="heading-toc">API</div>
          

          <ul class="list-toc">
            
              
              
              <li class="item-toc ">
                <a href="../api/apollo-client.html" class="sidebar-link ">
                  <span>Apollo Client</span>
                </a>
              </li>
              
            
              
              
              <li class="item-toc ">
                <a href="../api/react-apollo.html" class="sidebar-link ">
                  <span>React Apollo</span>
                </a>
              </li>
              
            
          </ul>
        </li>

        <hr>
      
    </ul>
  </div>
</div>

    <div class="content">

      <div class="header-content">
        <div class="header-wrapper">
          <div class="title-wrapper">
            <h1 class="title-page">
              Integrating with Meteor
            </h1>
            
              <div class="subtitle-page">
                Specifics about using Apollo in your Meteor application.
              </div>
              
          </div>
        </div>
      </div>

      <div class="content-wrapper">
        <div class="document-formatting">
          <p>There are two main ways to use Apollo in your Meteor app:</p>
<ul>
<li><code>meteor add swydo:ddp-apollo</code> provides a network Link that supports Meteor user accounts and subscriptions, all over DDP: <a href="https://github.com/Swydo/ddp-apollo" target="_blank" rel="noopener">Documentation</a></li>
<li><code>meteor add apollo</code> supports Meteor user accounts over HTTP, with documentation below.</li>
</ul>
<h2 id="Compatibility"><a href="#Compatibility" class="headerlink" title="Compatibility"></a>Compatibility</h2><table>
<thead>
<tr>
<th>meteor/apollo</th>
<th>apollo client</th>
<th>apollo server</th>
</tr>
</thead>
<tbody>
<tr>
<td>3.*</td>
<td>2.*</td>
<td>2.*</td>
</tr>
<tr>
<td>2.*</td>
<td>2.*</td>
<td>1.*</td>
</tr>
<tr>
<td>1.*</td>
<td>1.*</td>
<td>1.*</td>
</tr>
</tbody>
</table>
<h2 id="Usage"><a href="#Usage" class="headerlink" title="Usage"></a>Usage</h2>
<!-- Has Prism -->
<pre class="line-numbers" style=""><code class="language-sh">meteor add apollo
meteor npm install graphql apollo-server-express apollo-boost
</code></pre>
<h3 id="Client"><a href="#Client" class="headerlink" title="Client"></a>Client</h3><p>Create your <a href="https://www.apollographql.com/docs/react/">ApolloClient</a> instance:</p>

<!-- Has Prism -->
<pre class="line-numbers" style=""><code class="language-js">import { Accounts } from &#39;meteor&#x2F;accounts-base&#39;
import ApolloClient from &#39;apollo-boost&#39;

const client = new ApolloClient({
  uri: &#39;&#x2F;graphql&#39;,
  request: operation =&gt;
    operation.setContext(() =&gt; ({
      headers: {
        authorization: Accounts._storedLoginToken()
      }
    }))
})
</code></pre>
<p>Or if you’re using <code>apollo-client</code> instead of <code>apollo-boost</code>, use <code>MeteorAccountsLink()</code>:</p>

<!-- Has Prism -->
<pre class="line-numbers" style=""><code class="language-js">import { ApolloClient } from &#39;apollo-client&#39;
import { InMemoryCache } from &#39;apollo-cache-inmemory&#39;
import { ApolloLink } from &#39;apollo-link&#39;
import { HttpLink } from &#39;apollo-link-http&#39;
import { MeteorAccountsLink } from &#39;meteor&#x2F;apollo&#39;

const client = new ApolloClient({
  link: ApolloLink.from([
    new MeteorAccountsLink(),
    new HttpLink({
      uri: &#39;&#x2F;graphql&#39;
    })
  ]),
  cache: new InMemoryCache()
})
</code></pre>
<p>If you want to change which header the token is stored in:</p>

<!-- Has Prism -->
<pre class="line-numbers" style=""><code class="language-js">MeteorAccountsLink({ headerName: &#39;meteor-login-token&#39; })
</code></pre>
<p>(The default is <code>authorization</code>.)</p>
<h3 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h3><p>Set up the <a href="https://www.apollographql.com/docs/apollo-server/">Apollo server</a>:</p>

<!-- Has Prism -->
<pre class="line-numbers" style=""><code class="language-js">import { ApolloServer, gql } from &#39;apollo-server-express&#39;
import { WebApp } from &#39;meteor&#x2F;webapp&#39;
import { getUser } from &#39;meteor&#x2F;apollo&#39;

import typeDefs from &#39;.&#x2F;schema&#39;
import resolvers from &#39;.&#x2F;resolvers&#39;

const server = new ApolloServer({
  typeDefs,
  resolvers,
  context: async ({ req }) =&gt; ({
    user: await getUser(req.headers.authorization)
  })
})

server.applyMiddleware({
  app: WebApp.connectHandlers,
  path: &#39;&#x2F;graphql&#39;
})

WebApp.connectHandlers.use(&#39;&#x2F;graphql&#39;, (req, res) =&gt; {
  if (req.method === &#39;GET&#39;) {
    res.end()
  }
})
</code></pre>
<p>Now when the client is logged in (ie has an unexpired Meteor login token in localStorage), your resolvers will have a <code>context.user</code> property with the user doc.</p>
<h3 id="IDE"><a href="#IDE" class="headerlink" title="IDE"></a>IDE</h3><p>There are two options for using an IDE that will make authenticated GraphQL requests:</p>
<ul>
<li><a href="https://chrome.google.com/webstore/detail/apollo-client-developer-t/jdkknkkbebbapilgoeccciglkfbmbnfm?hl=en-US" target="_blank" rel="noopener">Apollo devtools</a> GraphiQL:<ul>
<li>Login to your app</li>
<li>Open Apollo devtools to the GraphiQL section</li>
</ul>
</li>
<li><a href="https://github.com/prismagraphql/graphql-playground" target="_blank" rel="noopener">GraphQL Playground</a>:<ul>
<li>Install with <code>brew cask install graphql-playground</code></li>
<li>Login to your app</li>
<li>In the browser console, enter <code>localStorage.getItem(&#39;Meteor.loginToken&#39;)</code></li>
<li>Copy the string returned</li>
<li>In Playground:<ul>
<li>At the top, enter <code>http://localhost:3000/graphql</code></li>
<li>Under HTTP HEADERS, enter <code>{ &quot;authorization&quot;: &quot;copied string&quot; }</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="Typings"><a href="#Typings" class="headerlink" title="Typings"></a>Typings</h3><p>Your Meteor apps may rely on static typings with TypeScript. If so, it is recommended to use the <a href="https://github.com/KeithGillette/Apollo-GraphQL-Meteor-Integration-Typings" target="_blank" rel="noopener">ambient TypeScript definition for this Atmosphere package</a>.</p>
<h2 id="Accounts"><a href="#Accounts" class="headerlink" title="Accounts"></a>Accounts</h2><p>The above solutions assume you’re using Meteor’s client-side accounts functions like <code>Accounts.createUser</code> and <code>Accounts.loginWith*</code>, which use Meteor DDP messages.</p>
<p>If you want to instead only use GraphQL in your app, you can use <a href="https://github.com/nicolaslopezj/meteor-apollo-accounts" target="_blank" rel="noopener">nicolaslopezj:apollo-accounts</a>. This package uses the Meteor Accounts methods in GraphQL, and it’s compatible with the accounts you have saved in your database (and you could use <code>nicolaslopezj:apollo-accounts</code> and Meteor’s DDP accounts at the same time).</p>
<p>If you are relying on the current user in your queries, you’ll want to <a href="http://dev.apollodata.com/react/auth.html#login-logout" target="_blank" rel="noopener">clear the store when the current user state changes</a>. To do so, use <code>client.resetStore()</code> in the <code>Meteor.logout</code> callback:</p>

<!-- Has Prism -->
<pre class="line-numbers" style=""><code class="language-clike">&#x2F;&#x2F; The `client` variable refers to your `ApolloClient` instance.
&#x2F;&#x2F; It would be imported in your template,
&#x2F;&#x2F; or passed via props thanks to `withApollo` in React for example.

Meteor.logout(function() {
  return client.resetStore(); &#x2F;&#x2F; make all active queries re-run when the log-out process completed
});
</code></pre>
<h2 id="SSR"><a href="#SSR" class="headerlink" title="SSR"></a>SSR</h2><p>There are two additional configurations that you need to keep in mind when using <a href="../features/server-side-rendering.html">React Server Side Rendering</a> with Meteor.</p>
<ol>
<li>Use <code>isomorphic-fetch</code> to polyfill <code>fetch</code> server-side (used by Apollo Client’s network interface).</li>
<li>Connect your express server to Meteor’s existing server with <a href="https://docs.meteor.com/packages/webapp.html" target="_blank" rel="noopener">WebApp.connectHandlers.use</a></li>
<li>Do not end the connection with <code>res.send()</code> and <code>res.end()</code> use <code>req.dynamicBody</code> and <code>req.dynamicHead</code> instead and call <code>next()</code>. <a href="https://github.com/meteor/meteor/pull/3860" target="_blank" rel="noopener">more info</a></li>
</ol>
<p>The idea is that you need to let Meteor to finally render the html you can just provide it extra <code>body</code> and or <code>head</code> for the html and Meteor will append it, otherwise CSS/JS and or other merged html content that Meteor serve by default (including your application main .js file) will be missing.</p>
<p>Here is a full working example using <code>apollo@2.*</code> (outdated):</p>

<!-- Has Prism -->
<pre class="line-numbers" style=""><code class="language-clike">meteor add apollo webapp
meteor npm install --save react react-dom apollo-client redux react-apollo react-router react-helmet express isomorphic-fetch
</code></pre>

<!-- Has Prism -->
<pre class="line-numbers" style=""><code class="language-js">import { Meteor } from &#39;meteor&#x2F;meteor&#39;;
import { WebApp } from &#39;meteor&#x2F;webapp&#39;;
import { meteorClientConfig, createMeteorNetworkInterface } from &#39;meteor&#x2F;apollo&#39;;
import React from &#39;react&#39;;
import ReactDOM from &#39;react-dom&#x2F;server&#39;;
import ApolloClient from &#39;apollo-client&#39;;
import { createStore, combineReducers, applyMiddleware, compose } from &#39;redux&#39;;
import { ApolloProvider, renderToStringWithData } from &#39;react-apollo&#39;;
import { match, RouterContext } from &#39;react-router&#39;;
import Express from &#39;express&#39;;
&#x2F;&#x2F; #1 import isomorphic-fetch so the network interface can be created
import &#39;isomorphic-fetch&#39;;
import Helmet from &#39;react-helmet&#39;;

import routes from &#39;..&#x2F;both&#x2F;routes&#39;;
import rootReducer from &#39;..&#x2F;..&#x2F;ui&#x2F;reducers&#39;;
import Body from &#39;..&#x2F;both&#x2F;routes&#x2F;body&#39;;

&#x2F;&#x2F; 1# do not use new
const app = Express(); &#x2F;&#x2F; eslint-disable-line new-cap

app.use((req, res, next) =&gt; {
  match({ routes, location: req.originalUrl }, (error, redirectLocation, renderProps) =&gt; {
    if (redirectLocation) {
      res.redirect(redirectLocation.pathname + redirectLocation.search);
    } else if (error) {
      console.error(&#39;ROUTER ERROR:&#39;, error); &#x2F;&#x2F; eslint-disable-line no-console
      res.status(500);
    } else if (renderProps) {
      &#x2F;&#x2F; use createMeteorNetworkInterface to get a preconfigured network interface
      &#x2F;&#x2F; #1 network interface can be used server-side thanks to polyfilled `fetch`
      const networkInterface = createMeteorNetworkInterface({
        opts: {
          credentials: &#39;same-origin&#39;,
          headers: req.headers,
        },
        &#x2F;&#x2F; possible current user login token stored in the cookies thanks to
        &#x2F;&#x2F; a third-party package like meteorhacks:fast-render
        loginToken: req.cookies[&#39;meteor-login-token&#39;],
      });

      &#x2F;&#x2F; use meteorClientConfig to get a preconfigured Apollo Client options object
      const client = new ApolloClient(meteorClientConfig({ networkInterface }));

      const store = createStore(
        combineReducers({
          ...rootReducer,
          apollo: client.reducer(),
        }),
        {}, &#x2F;&#x2F; initial state
        compose(
          applyMiddleware(client.middleware()),
        ),
      );

      const component = (
        &lt;ApolloProvider store={store} client={client}&gt;
          &lt;RouterContext {...renderProps} &#x2F;&gt;
        &lt;&#x2F;ApolloProvider&gt;
      );

      renderToStringWithData(component).then((content) =&gt; {
        const initialState = client.store.getState()[client.reduxRootKey].data;
        &#x2F;&#x2F; the body content we want to append
        const body = &lt;Body content={content} state={initialState} &#x2F;&gt;;
        &#x2F;&#x2F; #3 `req.dynamicBody` will hold that body and meteor will take care of
        &#x2F;&#x2F; actually appending it to the end result
        req.dynamicBody = ReactDOM.renderToStaticMarkup(body);
        const head = Helmet.rewind();
        &#x2F;&#x2F; #3 `req.dynamicHead` in this case we use `react-helmet` to add seo tags
        req.dynamicHead = `  ${head.title.toString()}
  ${head.meta.toString()}
  ${head.link.toString()}
`;
        &#x2F;&#x2F; #3 Important we do not want to return this, we just let meteor handle it
        next();
      });
    } else {
      console.log(&#39;not found&#39;); &#x2F;&#x2F; eslint-disable-line no-console
    }
  });
});
&#x2F;&#x2F; #2 connect your express server with meteor&#39;s
WebApp.connectHandlers.use(Meteor.bindEnvironment(app));
</code></pre>
<h2 id="Importing-graphql-files"><a href="#Importing-graphql-files" class="headerlink" title="Importing .graphql files"></a>Importing <code>.graphql</code> files</h2><p>An easy way to work with GraphQL is by importing <code>.graphql</code> files directly using the <code>import</code> syntax.</p>

<!-- Has Prism -->
<pre class="line-numbers" style=""><code class="language-bash">meteor add swydo:graphql
</code></pre>
<p>Instead of the <code>/imports/api/schema.js</code> file, create a <code>/imports/api/schema.graphql</code> file with the same content as before:</p>

<!-- Has Prism -->
<pre class="line-numbers" style=""><code class="language-graphql">type Query {
  say: String
}
</code></pre>
<p>One of the benefits you’ll get right away is good highlighting by GitHub and your IDE!</p>
<p>Now we can import the schema:</p>

<!-- Has Prism -->
<pre class="line-numbers" style=""><code class="language-js">import typeDefs from &#39;&#x2F;imports&#x2F;api&#x2F;schema.graphql&#39;;
</code></pre>
<p>Use <code>typeDefs</code> as before in the above examples. You can <a href="https://github.com/apollographql/graphql-tools/pull/300" target="_blank" rel="noopener">pass it directly to <code>makeExecutableSchema</code></a> like before.</p>
<p>The import syntax will also work for any other <code>.graphql</code> file besides your main schema. So you’ll be able to import query, mutation and subscription files without needing to manually parse them with the <a href="https://github.com/apollographql/graphql-tag" target="_blank" rel="noopener">graphql-tag</a>.</p>
<p>For more benefits, see the <a href="https://github.com/Swydo/meteor-graphql/blob/master/README.md#benefits" target="_blank" rel="noopener">GrahpQL build plugin README</a>.</p>
<h2 id="Blaze"><a href="#Blaze" class="headerlink" title="Blaze"></a>Blaze</h2><p>If you are looking to integrate Apollo with <a href="http://blazejs.org/" target="_blank" rel="noopener">Blaze</a>, you can use the <a href="https://github.com/Swydo/blaze-apollo" target="_blank" rel="noopener">swydo:blaze-apollo</a> package:</p>

<!-- Has Prism -->
<pre class="line-numbers" style=""><code class="language-js">import { setup } from &#39;meteor&#x2F;swydo:blaze-apollo&#39;;

const client = new ApolloClient(meteorClientConfig());

setup({ client });
</code></pre>
<p>This gives you reactive GraphQL queries in your templates!</p>

<!-- Has Prism -->
<pre class="line-numbers" style=""><code class="language-js">Template.hello.helpers({
  hello() {
    return Template.instance().gqlQuery({
      query: HELLO_QUERY
    }).get();
  }
});
</code></pre>
<h2 id="Subscriptions"><a href="#Subscriptions" class="headerlink" title="Subscriptions"></a>Subscriptions</h2><p><em>This section uses the outdated `apollo@2.</em>` API.*</p>
<p>You can also use GraphQL subscriptions with your Meteor app if you need to. The following code gives an example of a complete configuration that enables all the features of subscriptions in addition to base GraphQL.</p>
<h3 id="Client-1"><a href="#Client-1" class="headerlink" title="Client"></a>Client</h3>
<!-- Has Prism -->
<pre class="line-numbers" style=""><code class="language-js">import { ApolloClient } from &#39;apollo-client&#39;;
import { SubscriptionClient, addGraphQLSubscriptions } from &#39;subscriptions-transport-ws&#39;;
import { getMeteorLoginToken, createMeteorNetworkInterface } from &#39;meteor&#x2F;apollo&#39;;

&#x2F;&#x2F; &quot;basic&quot; Meteor network interface
const networkInterface = createMeteorNetworkInterface();

&#x2F;&#x2F; create a websocket uri based on your app absolute url (ROOT_URL), ex: ws:&#x2F;&#x2F;localhost:3000
const websocketUri = Meteor.absoluteUrl(&#39;subscriptions&#39;).replace(&#x2F;^http&#x2F;, &#39;ws&#39;);

&#x2F;&#x2F; create a websocket client
const wsClient = new SubscriptionClient(websocketUri, {
  reconnect: true,
  &#x2F;&#x2F; pass some extra information to the subscription, like the current user:
  connectionParams: {
    &#x2F;&#x2F; getMeteorLoginToken = get the Meteor current user login token from local storage
    meteorLoginToken: getMeteorLoginToken(),
  },
});

&#x2F;&#x2F; enhance the interface with graphql subscriptions
const networkInterfaceWithSubscriptions = addGraphQLSubscriptions(networkInterface, wsClient);

&#x2F;&#x2F; enjoy graphql subscriptions with Apollo Client
const client = new ApolloClient({ networkInterface: networkInterfaceWithSubscriptions });
</code></pre>
<h3 id="Server-1"><a href="#Server-1" class="headerlink" title="Server"></a>Server</h3><p>The same <code>context</code> is used for both the resolvers and the GraphQL subscriptions. This also means that <a href="http://dev.apollodata.com/tools/graphql-subscriptions/authentication.html" target="_blank" rel="noopener">authentication in the websocket transport</a> is configured out-of-the-box.</p>
<p>Note that <code>PubSub</code> from <code>graphql-subscriptions</code> is not suitable for production. You should wire your <code>SubscriptionManager</code> with <a href="https://github.com/davidyaha/graphql-redis-subscriptions" target="_blank" rel="noopener">Redis subscriptions</a> or <a href="https://github.com/davidyaha/graphql-mqtt-subscriptions" target="_blank" rel="noopener">MQTT subscriptions</a> in case you want to use them in production apps.</p>

<!-- Has Prism -->
<pre class="line-numbers" style=""><code class="language-js">import { SubscriptionManager } from &#39;graphql-subscriptions&#39;;
import { SubscriptionServer } from &#39;subscriptions-transport-ws&#39;;
import { createApolloServer, addCurrentUserToContext } from &#39;meteor&#x2F;apollo&#39;;

&#x2F;&#x2F; your executable schema
const schema = ...

&#x2F;&#x2F; any additional context you use for your resolvers, if any
const context = {};

&#x2F;&#x2F; the pubsub mechanism of your choice, for instance:
&#x2F;&#x2F; - PubSub from graphql-subscriptions (not recommended for production)
&#x2F;&#x2F; - RedisPubSub from graphql-redis-subscriptions
&#x2F;&#x2F; - MQTTPubSub from graphql-mqtt-subscriptions
const pubsub = new PubSub();

&#x2F;&#x2F; subscriptions path which fits witht the one you connect to on the client
const subscriptionsPath = &#39;&#x2F;subscriptions&#39;;

&#x2F;&#x2F; start a graphql server with Express handling a possible Meteor current user
createApolloServer({
  schema,
  context
});

&#x2F;&#x2F; create the subscription manager thanks to the schema &amp; the pubsub mechanism
const subscriptionManager = new SubscriptionManager({
  schema,
  pubsub,
});

&#x2F;&#x2F; start up a subscription server
new SubscriptionServer(
  {
    subscriptionManager,
    &#x2F;&#x2F; on connect subscription lifecycle event
    onConnect: async (connectionParams, webSocket) =&gt; {
      &#x2F;&#x2F; if a meteor login token is passed to the connection params from the client,
      &#x2F;&#x2F; add the current user to the subscription context
      const subscriptionContext = connectionParams.meteorLoginToken
        ? await addCurrentUserToContext(context, connectionParams.meteorLoginToken)
        : context;

      return subscriptionContext;
    },
  },
  {
    &#x2F;&#x2F; bind the subscription server to Meteor WebApp
    server: WebApp.httpServer,
    path: subscriptionsPath,
  }
);
</code></pre>

        </div>
      </div>

      <div class="pagination">
        <div class="content-wrapper">
          
          
         
              <a class="link primary prev" href="webpack.html">
                <span class="icon-arrow-left-alt"></span>
                <span class="subtitle-pagination">Previous</span>
                Loading queries with Webpack
              </a>
         
          
          
           
              <a class="link primary next" href="recompose.html">
                <span class="subtitle-pagination">Next</span>
                Recompose patterns
                  <span class="icon-arrow-right-alt"></span>
              </a>
           
          
        </div>
      </div>

      <div class="github">
        <a class="link tertiary " href="https://github.com/apollographql/apollo-client/tree/master/docs/source/recipes/meteor.md" target="_blank">
          <span class="icon-github"></span>Edit on GitHub</a>
      </div>

      
    </div>

    
    <script type="text/javascript" src="//cdn.jsdelivr.net/npm/prismjs@1.15.0/prism.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/npm/prismjs@1.15.0/plugins/line-numbers/prism-line-numbers.min.js"></script>
    <script type="text/javascript" src="//cdn.jsdelivr.net/npm/prismjs@1.15.0/plugins/line-highlight/prism-line-highlight.min.js"></script>
        <script type="text/javascript" src="//cdn.jsdelivr.net/combine/npm/prismjs@1.15.0/components/prism-bash.min.js,npm/prismjs@1.15.0/components/prism-graphql.min.js,npm/prismjs@1.15.0/components/prism-json.min.js,npm/prismjs@1.15.0/components/prism-jsx.min.js,npm/prismjs@1.15.0/components/prism-less.min.js,npm/prismjs@1.15.0/components/prism-swift.min.js,npm/prismjs@1.15.0/components/prism-typescript.min.js,npm/prismjs@1.15.0/components/prism-yaml.min.js"></script>

    <script type="text/javascript" src="//cdn.jsdelivr.net/npm/smooth-scroll@12.1.5/dist/js/smooth-scroll.min.js"></script>

    <script>
      // Used by the main.js script below.
      docsConfigRoot = '/docs/react/';
    </script>
    <script src="../script/main.js"></script>

    
      <script type="text/javascript" src="//cdn.jsdelivr.net/npm/docsearch.js@2/dist/cdn/docsearch.min.js"></script>
    
    <script type="text/javascript" src="//cdn.jsdelivr.net/fastclick/1.0.6/fastclick.min.js"></script>

    <script>
      // nectar ninja
      (function(){
        var handle = '@meteorjs';
        var a = document.createElement('script');
        var m = document.getElementsByTagName('script')[0];
        a.async = 1;
        a.src = 'https://nectar.ninja/api/v1/' + handle.slice(1);
        m.parentNode.insertBefore(a, m);
      })();
    </script>

    

    
      <script>
        
        var analytics;

        <!-- Segment.io -->
        !function(){var analytics=window.analytics=window.analytics||[];if(!analytics.initialize)if(analytics.invoked)window.console&&console.error&&console.error("Segment snippet included twice.");else{analytics.invoked=!0;analytics.methods=["trackSubmit","trackClick","trackLink","trackForm","pageview","identify","reset","group","track","ready","alias","debug","page","once","off","on"];analytics.factory=function(t){return function(){var e=Array.prototype.slice.call(arguments);e.unshift(t);analytics.push(e);return analytics}};for(var t=0;t<analytics.methods.length;t++){var e=analytics.methods[t];analytics[e]=analytics.factory(e)}analytics.load=function(t,e){var n=document.createElement("script");n.type="text/javascript";n.async=!0;n.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.com/analytics.js/v1/"+t+"/analytics.min.js";var o=document.getElementsByTagName("script")[0];o.parentNode.insertBefore(n,o);analytics._loadOptions=e};analytics.SNIPPET_VERSION="4.1.0";
        analytics.load("wgrIo8Bul0Ujl8USETG3DB6hONdy4kTg");
        analytics.page();
        }}();
      </script>
    

    // search box
    
      <script>
        ['desktop'].forEach(function(type) {
          var search = docsearch({
            apiKey: '768e823959d35bbd51e4b2439be13fb7',
            
            
            indexName: 'apollodata',
            inputSelector: '#' + type + '-search-input',
            autocompleteOptions: {
              dropdownMenuContainer: '.wrapper-' + type + '-search-results',
              debug: true
            },
            algoliaOptions: {
              hitsPerPage: 20
            }
          }).autocomplete;

          var sidebar = document.querySelector('.sidebar-content');
          search.on('autocomplete:opened', function() {
            sidebar.classList.add('searching');
          });
          search.on('autocomplete:closed', function() {
            sidebar.classList.remove('searching');
          });
          search.on('autocomplete:updated', function() {
            if (search.val() === '') {
              search.autocomplete.close();
            }
          });
        });
      </script>
    

    
      <script>
        var REDIRECTS = {
  "/docs/react/essentials/get-started.html#api": "docs/react/api/react-apollo.html",
  "/docs/react/essentials/queries.html#api": "docs/react/api/react-apollo.html#graphql-query-options",
  "/docs/react/basics/mutations.html#api": "docs/react/api/react-apollo.html#graphql-mutation-options",
  "/docs/react/recipes/simple-example.html": "docs/react/essentials/get-started.html",
  "/docs/react/api/apollo-client.html#FetchPolicy": "docs/react/api/react-apollo.html#graphql-config-options-fetchPolicy",
  "/docs/react/api/apollo-client.html#ErrorPolicy": "docs/react/api/react-apollo.html#graphql-config-options-errorPolicy",
  "/docs/react/features/performance.html": "/docs/react/recipes/performance.html"
};

        function redirect() {
          // Support redirects of the form /path#hash
          var locationKey = location.pathname + location.hash;
          if (REDIRECTS[locationKey]) {
            location.replace(location.origin + '/' + REDIRECTS[locationKey]);
          }

          // Support redirects of the form #hash (works for any path)
          var hashKey = location.hash;
          if (REDIRECTS[hashKey]) {
            location.replace(location.origin + '/' + REDIRECTS[hashKey]);
          }
        }

        // Redirect now
        redirect();

        // Redirect on hash change
        window.onhashchange = redirect;
      </script>
    

    <script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
    <script>
      window.addEventListener('load', function () {
        window.cookieconsent.initialise({
          palette: {
            popup: {
              background: '#555',
            },
            button: {
              text: '#333',
              background: '#CCC',
            },
          },
        })
      });
    </script>
  </body>
</html>
